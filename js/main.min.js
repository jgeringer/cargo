isInline=[];$.each(cargo,function(a,b){if(b.iframe===false){isInline.push(b.airline)}});tracePrefix="http://cargoserv.champ.aero/trace/trace.asp?",carrierCode="",carrierQS="",trace="",shipmentText="",myHistory=JSON.parse(localStorage.getItem("myHistoryInfo"))||[];$(".test").on("click",function(c){c.preventDefault();$(".trackingForm").trigger("submit");var b=$("#tracking-frame"),a=$("#load");a.removeClass("active");b.addClass("active")});$("#search").on("submit",function(f){f.preventDefault();var g=$(".search"),i=g.val(),h=$("#load"),b=$("#tracking-frame"),c=g.val().slice(0,3),j=g.val().slice(3,11),l="";_gaq.push(["_trackEvent","Tracking Number",i]);$(".page-loader").addClass("active");if($.inArray(c,isInline)>-1){console.log("inline");$.each(cargo,function(e,m){if(m.airline===c){l=m.code;$(".friendly-name").text(m.name)}});carrierQS="Carrier="+l;shipmentText="&Shipment_text="+g.val();path=tracePrefix+carrierQS+shipmentText+"&Header=no&Site=CservWidth=800&Height=400";requestCrossDomain(path,l,c,j,function(e){h.addClass("active");b.removeClass("active");$("#load").html(e);$(".page-loader").removeClass("active")})}else{console.log("iframe");var k=i.slice(0,3),d=i.slice(3,11);lookupIframe(k,d)}if(typeof(Storage)!=="undefined"){myHistory.push({fullNumber:i});localStorage.setItem("myHistoryInfo",JSON.stringify(myHistory));var a=function(m){var e=JSON.parse(localStorage.getItem("myHistoryInfo")||[]);e.push({fullNumber:m});localStorage.setItem("myHistoryInfo",JSON.stringify(e))}}else{}getHistory()});$(document).on("click","#myHistory span",function(b){var a=$(this);$(".search").val(a.text());lookupAirlines(a.text().slice(0,3));$("#search").trigger("submit");$(".recent-container").slideUp(function(){})});$(".searchHistoryNav").off("click").on("click",function(a){a.preventDefault();$(".recent-container").slideToggle(function(){})});function getHistory(){$("#myHistory").empty();var b=localStorage.getItem("myHistoryInfo"),c=JSON.parse(b),a="";$.each(c,function(d,e){if(d===0){$("#myHistory").append("<span>"+e.fullNumber+"</span>")}else{$("#myHistory").append(", <span>"+e.fullNumber+"</span>")}});$("#myHistory").text().slice(2)}function requestCrossDomain(a,c,e,b,f){if(!a){alert("No site was passed.");return false}var d="https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from html where url="'+a+'"')+"&format=xml&callback=?";console.log("yql:",d);$.getJSON(d,function(i){console.log("data.results[0]:",i.results[0]);if(i.results[0]){i=i.results[0].replace(/<script[^>]*>[\s\S]*?<\/script>/,"");if(typeof f==="function"){f(i)}}else{console.log("Nothing returned from getJSON.");var h=$("#tracking-frame"),g=$("#load");$(".trackingForm").remove();g.removeClass("active");$.ajax({url:"forms/"+c+".html",success:function(j){console.log("inside load...");console.log("data...",j);$(j).appendTo(".data-container");$(".data-container").find(".airlineCode").val(e);$(".data-container").find(".cargoNumber").val(b);$(".trackingForm").trigger("submit");h.addClass("active")}})}$(".page-loader").removeClass("active")})}function lookupIframe(d,b){console.log("ac:",d);console.log("cn:",b);var c=$("#tracking-frame"),a=$("#load");$(".trackingForm").remove();$.each(cargo,function(i,j){if(j.airline===d){var g=j.code,f=(j.direct),h=(j.combined),e=(j.combinedConcat);console.log("DIRECT?",f);console.log("COMBINED?",h);console.log("COMBINED CONCAT?",e);if(f){c.attr("src",j.url1+d+j.url2+b);a.removeClass("active");c.addClass("active");$(".friendly-name").text(j.name);return}$.ajax({url:"forms/"+g+".html",success:function(k){console.log("inside load...");console.log("data...",k);$(k).appendTo(".data-container");if(h){$(".data-container").find(".combined").val(d+"-"+b)}else{if(e){$(".data-container").find(".combinedConcat").val(d+b)}else{$(".data-container").find(".airlineCode").val(d);$(".data-container").find(".cargoNumber").val(b)}}$(".trackingForm").trigger("submit")}});a.removeClass("active");c.addClass("active");$(".friendly-name").text(j.name);return}});$(".page-loader").removeClass("active")}$(".search").off("keyup").on("keyup",function(b){var a=$(this);if(a.val().length>=3){lookupAirlines(a.val().slice(0,3))}});function lookupAirlines(a){$.each(cargo,function(b,c){if(a===c.airline){$(".search").css({"background-image":"url("+c.img+")"})}})}$(function(){if(typeof(Storage)!=="undefined"){getHistory()}});